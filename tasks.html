<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Görevler</title>
  <style>
    button {
      padding: 10px;
      margin: 10px;
    }
    .completed {
      background-color: #c3ffc3;
    }
  </style>
</head>
<body>
  <h2>🔥 Görev Tamamlama Adımı: <span id="progress">0 / 3</span></h2>
  <h3>👤 Kullanıcı Adınız: <input type="text" id="username" placeholder="örnek: kullanici123" /></h3>

  <div>
    <h4>✅ Görev 1: Bu butona 5 kez tıkla</h4>
    <button onclick="handleClick(1)">Tıkla (Görev 1)</button>
    <span id="count1">0 / 5</span>
  </div>

  <div>
    <h4>✅ Görev 2: Bu butona 3 kez tıkla</h4>
    <button onclick="handleClick(2)">Tıkla (Görev 2)</button>
    <span id="count2">0 / 3</span>
  </div>

  <div>
    <h4>✅ Görev 3: Bu butona 4 kez tıkla</h4>
    <button onclick="handleClick(3)">Tıkla (Görev 3)</button>
    <span id="count3">0 / 4</span>
  </div>

  <div style="margin-top: 30px;">
    <button id="joinButton" onclick="joinDraw()" disabled>🎁 Çekilişe Katıl</button>
    <p id="statusMessage"></p>
  </div>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.0/firebase-app.js";
    import { getFirestore, doc, setDoc, getDoc, updateDoc } from "https://www.gstatic.com/firebasejs/11.6.0/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "AIzaSyBXbLpzgMa8wiiYcXhVDsOSRzVx_zdplXw",
      authDomain: "cekilisveritabani.firebaseapp.com",
      projectId: "cekilisveritabani",
      storageBucket: "cekilisveritabani.appspot.com",
      messagingSenderId: "246236686196",
      appId: "1:246236686196:web:d22a9b99140626cc04ae21"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    let clickCounts = { 1: 0, 2: 0, 3: 0 };
    let goals = { 1: 5, 2: 3, 3: 4 };
    let completedTasks = 0;

    function handleClick(taskNumber) {
      if (clickCounts[taskNumber] >= goals[taskNumber]) return;

      clickCounts[taskNumber]++;
      document.getElementById(`count${taskNumber}`).textContent = `${clickCounts[taskNumber]} / ${goals[taskNumber]}`;

      if (clickCounts[taskNumber] === goals[taskNumber]) {
        completedTasks++;
        document.querySelectorAll("button")[taskNumber].classList.add("completed");
        updateProgress();
      }
    }

    function updateProgress() {
      document.getElementById("progress").textContent = `${completedTasks} / 3`;
      if (completedTasks === 3) {
        document.getElementById("joinButton").disabled = false;
      }
    }

    async function joinDraw() {
      const username = document.getElementById("username").value.trim();
      if (!username) {
        alert("Lütfen kullanıcı adınızı girin.");
        return;
      }

      const userRef = doc(db, "drawParticipants", username);
      const userSnap = await getDoc(userRef);

      if (!userSnap.exists()) {
        await setDoc(userRef, { username: username, joinedAt: new Date() });
        document.getElementById("statusMessage").textContent = "🎉 Çekilişe başarıyla katıldınız!";
      } else {
        document.getElementById("statusMessage").textContent = "❗ Zaten çekilişe katıldınız.";
      }
    }
  </script>
</body>
</html>
